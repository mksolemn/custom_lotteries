var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r){var n=this.getPalette(t,5,r),e=n[0];return e},ColorThief.prototype.getPalette=function(t,r,n){("undefined"==typeof r||r<2||r>256)&&(r=10),("undefined"==typeof n||n<1)&&(n=10);for(var e,o,a,i,u,c=new CanvasImage(t),s=c.getImageData(),f=s.data,h=c.getPixelCount(),v=[],p=0;p<h;p+=n)e=4*p,o=f[e+0],a=f[e+1],i=f[e+2],u=f[e+3],u>=125&&(o>250&&a>250&&i>250||v.push([o,a,i]));var g=MMCQ.quantize(v,r),l=g?g.palette():null;return c.removeCanvas(),l},ColorThief.prototype.getColorFromUrl=function(t,r,n){sourceImage=document.createElement("img");var e=this;sourceImage.addEventListener("load",function(){var o=e.getPalette(sourceImage,5,n),a=o[0];r(a,t)}),sourceImage.src=t},ColorThief.prototype.getImageData=function(t,r){xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.responseType="arraybuffer",xhr.onload=function(t){if(200==this.status){uInt8Array=new Uint8Array(this.response),n=uInt8Array.length,binaryString=new Array(n);for(var n=0;n<uInt8Array.length;n++)binaryString[n]=String.fromCharCode(uInt8Array[n]);data=binaryString.join(""),base64=window.btoa(data),r("data:image/png;base64,"+base64)}},xhr.send()},ColorThief.prototype.getColorAsync=function(t,r,n){var e=this;this.getImageData(t,function(t){sourceImage=document.createElement("img"),sourceImage.addEventListener("load",function(){var t=e.getPalette(sourceImage,5,n),o=t[0];r(o,this)}),sourceImage.src=t})},!pv)var pv={map:function(t,r){var n={};return r?t.map(function(t,e){return n.index=e,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,e,o){return n.index=o,t+r.call(n,e)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){function t(t,r,n){return(t<<2*c)+(r<<c)+n}function r(t){function r(){n.sort(t),e=!0}var n=[],e=!1;return{push:function(t){n.push(t),e=!1},peek:function(t){return e||r(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return e||r(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return e||r(),n}}}function n(t,r,n,e,o,a,i){var u=this;u.r1=t,u.r2=r,u.g1=n,u.g2=e,u.b1=o,u.b2=a,u.histo=i}function e(){this.vboxes=new r(function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function o(r){var n,e,o,a,i=1<<3*c,u=new Array(i);return r.forEach(function(r){e=r[0]>>s,o=r[1]>>s,a=r[2]>>s,n=t(e,o,a),u[n]=(u[n]||0)+1}),u}function a(t,r){var e,o,a,i=1e6,u=0,c=1e6,f=0,h=1e6,v=0;return t.forEach(function(t){e=t[0]>>s,o=t[1]>>s,a=t[2]>>s,e<i?i=e:e>u&&(u=e),o<c?c=o:o>f&&(f=o),a<h?h=a:a>v&&(v=a)}),new n(i,u,c,f,h,v,r)}function i(r,n){function e(t){var r,e,o,a,i,u=t+"1",s=t+"2",f=0;for(c=n[u];c<=n[s];c++)if(g[c]>p/2){for(o=n.copy(),a=n.copy(),r=c-n[u],e=n[s]-c,i=r<=e?Math.min(n[s]-1,~~(c+e/2)):Math.max(n[u],~~(c-1-r/2));!g[i];)i++;for(f=l[i];!f&&g[i-1];)f=l[--i];return o[s]=i,a[u]=o[s]+1,[o,a]}}if(n.count()){var o=n.r2-n.r1+1,a=n.g2-n.g1+1,i=n.b2-n.b1+1,u=pv.max([o,a,i]);if(1==n.count())return[n.copy()];var c,s,f,h,v,p=0,g=[],l=[];if(u==o)for(c=n.r1;c<=n.r2;c++){for(h=0,s=n.g1;s<=n.g2;s++)for(f=n.b1;f<=n.b2;f++)v=t(c,s,f),h+=r[v]||0;p+=h,g[c]=p}else if(u==a)for(c=n.g1;c<=n.g2;c++){for(h=0,s=n.r1;s<=n.r2;s++)for(f=n.b1;f<=n.b2;f++)v=t(s,c,f),h+=r[v]||0;p+=h,g[c]=p}else for(c=n.b1;c<=n.b2;c++){for(h=0,s=n.r1;s<=n.r2;s++)for(f=n.g1;f<=n.g2;f++)v=t(s,f,c),h+=r[v]||0;p+=h,g[c]=p}return g.forEach(function(t,r){l[r]=p-t}),e(u==o?"r":u==a?"g":"b")}}function u(t,n){function u(t,r){for(var n,e=1,o=0;o<f;)if(n=t.pop(),n.count()){var a=i(c,n),u=a[0],s=a[1];if(!u)return;if(t.push(u),s&&(t.push(s),e++),e>=r)return;if(o++>f)return}else t.push(n),o++}if(!t.length||n<2||n>256)return!1;var c=o(t),s=0;c.forEach(function(){s++});var v=a(t,c),p=new r(function(t,r){return pv.naturalOrder(t.count(),r.count())});p.push(v),u(p,h*n);for(var g=new r(function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});p.size();)g.push(p.pop());u(g,n-g.size());for(var l=new e;g.size();)l.push(g.pop());return l}var c=5,s=8-c,f=1e3,h=.75;return n.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(r){var n=this,e=n.histo;if(!n._count_set||r){var o,a,i,u,c=0;for(a=n.r1;a<=n.r2;a++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)o=t(a,i,u),c+=e[o]||0;n._count=c,n._count_set=!0}return n._count},copy:function(){var t=this;return new n(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var n=this,e=n.histo;if(!n._avg||r){var o,a,i,u,s,f=0,h=1<<8-c,v=0,p=0,g=0;for(a=n.r1;a<=n.r2;a++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)s=t(a,i,u),o=e[s]||0,f+=o,v+=o*(a+.5)*h,p+=o*(i+.5)*h,g+=o*(u+.5)*h;f?n._avg=[~~(v/f),~~(p/f),~~(g/f)]:n._avg=[~~(h*(n.r1+n.r2+1)/2),~~(h*(n.g1+n.g2+1)/2),~~(h*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(t){var r=this,n=t[0]>>s;return gval=t[1]>>s,bval=t[2]>>s,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},e.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,e,o=this.vboxes,a=0;a<o.size();a++)n=Math.sqrt(Math.pow(t[0]-o.peek(a).color[0],2)+Math.pow(t[1]-o.peek(a).color[1],2)+Math.pow(t[2]-o.peek(a).color[2],2)),(n<r||void 0===r)&&(r=n,e=o.peek(a).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,e=t[n].color;e[0]>251&&e[1]>251&&e[2]>251&&(t[n].color=[255,255,255])}},{quantize:u}}();